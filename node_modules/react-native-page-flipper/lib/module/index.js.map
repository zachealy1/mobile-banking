{"version":3,"names":["usePrevious","useSetState","React","useEffect","useState","useCallback","useMemo","useRef","StyleSheet","View","BookPage","BookPagePortrait","createPages","BookPageBackground","debug","logger","msg","console","log","PageFlipper","forwardRef","ref","data","enabled","pressable","singleImageMode","renderLastPage","portrait","onFlippedEnd","onFlipStart","onPageDrag","onPageDragEnd","onPageDragStart","onEndReached","onInitialized","renderContainer","renderPage","pageSize","height","width","contentContainerStyle","setLayout","state","setState","pageIndex","pages","isAnimating","initialized","prev","left","right","current","next","nextPageIndex","undefined","isPortrait","isAnimatingRef","prevBookPage","nextBookPage","portraitBookPage","previousPortrait","containerSize","size","finalSize","ratio","diff","initialize","allPages","adjustedIndex","getAdjustedIndex","index","error","turnPage","goToPage","isNaN","length","previousPage","newIndex","nextPage","useImperativeHandle","Math","floor","onLayout","e","nativeEvent","layout","onPageFlipped","setIsAnimating","val","getPageStyle","front","pageStyle","position","isEvenPage","offset","isFirstPage","isLastPage","isSecondToLastPage","shouldRenderLastPage","bookPageProps","onPageFlip","single","isPressable","ContentWrapper","Wrapper","styles","container","contentContainer","content","portraitContent","absoluteFillObject","zIndex","overflow","memo","props","wrap","Empty","create","flex","justifyContent","alignItems","flexDirection","backgroundColor"],"sources":["index.tsx"],"sourcesContent":["import usePrevious from './hooks/usePrevious';\nimport useSetState from './hooks/useSetState';\nimport React, { useEffect, useState, useCallback, useMemo } from 'react';\nimport { useRef } from 'react';\nimport { LayoutChangeEvent, StyleSheet, View, ViewStyle } from 'react-native';\nimport { BookPage, BookPageInstance, IBookPageProps } from './BookPage';\nimport {\n    BookPagePortrait,\n    PortraitBookInstance,\n} from './portrait/BookPagePortrait';\nimport type { Page, Size } from './types';\nimport { createPages } from './utils/utils';\nimport { BookPageBackground } from './BookPageBackground';\n\nexport type IPageFlipperProps = {\n    data: string[];\n    enabled?: boolean; // gestures\n    pressable?: boolean; // are the pages tappable\n    singleImageMode?: boolean;\n    renderLastPage?: () => React.ReactElement;\n    portrait?: boolean;\n    onFlippedEnd?: (index: number) => void;\n    onFlipStart?: (id: number) => void;\n    onPageDragStart?: () => void;\n    onPageDrag?: () => void;\n    onPageDragEnd?: () => void;\n    onEndReached?: () => void;\n    onInitialized?: (props: any) => void;\n    renderContainer?: () => any;\n    renderPage?: (data: any) => any;\n    pageSize: Size;\n    contentContainerStyle: ViewStyle;\n};\n\nexport type PageFlipperInstance = {\n    goToPage: (index: number) => void;\n    previousPage: () => void;\n    nextPage: () => void;\n};\n\nexport type State = {\n    pageIndex: number;\n    pages: Page[];\n    isAnimating: boolean;\n    initialized: boolean;\n    // pageSize: Size;\n    prev: Page;\n    current: Page;\n    next: Page;\n    nextPageIndex?: number;\n    isPortrait: boolean;\n};\n\nconst debug = true;\n\nconst logger = (msg: string) => {\n    if (debug) {\n        console.log(msg);\n    }\n};\n\nconst PageFlipper = React.forwardRef<PageFlipperInstance, IPageFlipperProps>(\n    (\n        {\n            data,\n            enabled = true,\n            pressable = true,\n            singleImageMode = true,\n            renderLastPage,\n            portrait = false,\n            onFlippedEnd,\n            onFlipStart,\n            onPageDrag,\n            onPageDragEnd,\n            onPageDragStart,\n            onEndReached,\n            onInitialized,\n            renderContainer,\n            renderPage,\n            pageSize = { height: 600, width: 400 },\n            contentContainerStyle,\n        },\n        ref\n    ) => {\n        const [{ width, height }, setLayout] = useState({\n            height: 0,\n            width: 0,\n        });\n        const [state, setState] = useSetState<State>({\n            pageIndex: 0,\n            pages: [],\n            isAnimating: false,\n            initialized: false,\n            // pageSize: { width: 0, height: 0 },\n            prev: { left: '', right: '' },\n            current: { left: '', right: '' },\n            next: { left: '', right: '' },\n            nextPageIndex: undefined,\n            isPortrait: portrait,\n        });\n        const isAnimatingRef = useRef(false);\n        const prevBookPage = useRef<BookPageInstance>(null);\n        const nextBookPage = useRef<BookPageInstance>(null);\n        const portraitBookPage = useRef<PortraitBookInstance>(null);\n        const previousPortrait = usePrevious(portrait);\n        const containerSize = useMemo(() => {\n            if (!state.initialized) {\n                return {\n                    width: 0,\n                    height: 0,\n                };\n            }\n            let size = {\n                height: pageSize.height,\n                width:\n                    singleImageMode && !state.isPortrait\n                        ? pageSize.width * 2\n                        : pageSize.width,\n            };\n\n            if (!singleImageMode && state.isPortrait) {\n                size = {\n                    height: pageSize.height,\n                    width: pageSize.width / 2,\n                };\n            }\n\n            let finalSize: Size;\n\n            // corrections\n            if (size.height > size.width) {\n                const ratio = size.height / size.width;\n                finalSize = {\n                    height: width * ratio,\n                    width,\n                };\n\n                if (finalSize.height > height) {\n                    const diff = finalSize.height / height;\n                    finalSize.height = height;\n                    finalSize.width = finalSize.width / diff;\n                }\n            } else {\n                const ratio = size.width / size.height;\n                finalSize = {\n                    height,\n                    width: height * ratio,\n                };\n                if (finalSize.width > width) {\n                    const diff = finalSize.width / width;\n                    finalSize.width = width;\n                    finalSize.height = finalSize.height / diff;\n                }\n            }\n\n            return finalSize;\n        }, [\n            height,\n            singleImageMode,\n            width,\n            state.initialized,\n            state.isPortrait,\n            pageSize.height,\n            pageSize.width,\n        ]);\n\n        useEffect(() => {\n            const initialize = async () => {\n                try {\n                    const allPages = createPages({\n                        portrait,\n                        singleImageMode,\n                        data,\n                    });\n\n                    let adjustedIndex = getAdjustedIndex(allPages);\n\n                    setState({\n                        initialized: true,\n                        pages: allPages,\n                        prev: allPages[adjustedIndex - 1],\n                        current: allPages[adjustedIndex],\n                        next: allPages[adjustedIndex + 1],\n                        pageIndex: adjustedIndex,\n                        isPortrait: portrait,\n                    });\n\n                    if (onInitialized) {\n                        onInitialized({\n                            pages: allPages,\n                            index: adjustedIndex,\n                        });\n                    }\n                } catch (error) {\n                    console.error('error', error);\n                }\n            };\n            initialize();\n            // eslint-disable-next-line\n        }, [data, portrait, singleImageMode]);\n\n        useEffect(() => {\n            if (state.nextPageIndex !== undefined) {\n                if (!state.isPortrait) {\n                    if (state.nextPageIndex > state.pageIndex) {\n                        nextBookPage.current?.turnPage();\n                    } else {\n                        prevBookPage.current?.turnPage();\n                    }\n                } else {\n                    portraitBookPage.current?.turnPage(\n                        state.nextPageIndex > state.pageIndex ? 1 : -1\n                    );\n                }\n            }\n            // eslint-disable-next-line\n        }, [state.nextPageIndex]);\n\n        const goToPage = useCallback(\n            (index: number) => {\n                if (index === undefined || index === null) {\n                    logger('index cannot be undefined or null');\n                    return;\n                }\n\n                if (typeof index !== 'number' || isNaN(index)) {\n                    logger('index must be a number');\n                    return;\n                }\n\n                if (index < 0 || index > state.pages.length - 1) {\n                    logger('invalid page');\n                    return;\n                }\n\n                if (isAnimatingRef.current) {\n                    logger('is already animating');\n                    return;\n                }\n\n                if (index === state.pageIndex) {\n                    logger('same page');\n                    return;\n                }\n\n                if (index > state.pageIndex) {\n                    setState({\n                        next: state.pages[index],\n                        nextPageIndex: index,\n                    });\n                } else {\n                    setState({\n                        prev: state.pages[index],\n                        nextPageIndex: index,\n                    });\n                }\n            },\n            [setState, state.pageIndex, state.pages]\n        );\n\n        const previousPage = useCallback(() => {\n            const newIndex = state.pageIndex - 1;\n            goToPage(newIndex);\n        }, [goToPage, state.pageIndex]);\n\n        const nextPage = useCallback(() => {\n            const newIndex = state.pageIndex + 1;\n            goToPage(newIndex);\n        }, [goToPage, state.pageIndex]);\n\n        React.useImperativeHandle(\n            ref,\n            () => ({\n                goToPage,\n                nextPage,\n                previousPage,\n            }),\n            [goToPage, nextPage, previousPage]\n        );\n\n        const getAdjustedIndex = (allPages: any[]) => {\n            // THIS NEEDS REWORKING\n            let adjustedIndex = state.pageIndex;\n            if (\n                previousPortrait !== undefined &&\n                previousPortrait !== portrait &&\n                singleImageMode\n            ) {\n                if (portrait) {\n                    adjustedIndex *= 2;\n                } else {\n                    adjustedIndex = Math.floor(\n                        adjustedIndex % 2 === 0\n                            ? adjustedIndex / 2\n                            : (adjustedIndex - 1) / 2\n                    );\n                }\n            }\n\n            if (adjustedIndex < 0 || adjustedIndex > allPages.length - 1) {\n                // invalid index, reset to 0\n                adjustedIndex = 0;\n            }\n            return adjustedIndex;\n        };\n\n        const onLayout = (e: LayoutChangeEvent) => {\n            setLayout({\n                height: e.nativeEvent.layout.height,\n                width: e.nativeEvent.layout.width,\n            });\n        };\n\n        const onPageFlipped = useCallback(\n            (index: number) => {\n                const newIndex =\n                    state.nextPageIndex !== undefined\n                        ? state.nextPageIndex\n                        : state.pageIndex + index;\n\n                if (newIndex < 0 || newIndex > state.pages.length - 1) {\n                    // this if condition theoretically should never occur in the first place, so it could be removed but it's here just in case\n                    logger('invalid page');\n\n                    setState({\n                        isAnimating: false,\n                        nextPageIndex: undefined,\n                    });\n                    isAnimatingRef.current = false;\n                    return;\n                }\n\n                const prev = state.pages[newIndex - 1];\n                const current = state.pages[newIndex];\n                const next = state.pages[newIndex + 1];\n                setState({\n                    pageIndex: newIndex,\n                    isAnimating: false,\n                    prev,\n                    current,\n                    next,\n                    nextPageIndex: undefined,\n                });\n                isAnimatingRef.current = false;\n                if (onFlippedEnd && typeof onFlippedEnd === 'function') {\n                    onFlippedEnd(newIndex);\n                }\n\n                if (newIndex === state.pages.length - 1 && onEndReached) {\n                    onEndReached();\n                }\n            },\n            [\n                onEndReached,\n                onFlippedEnd,\n                setState,\n                state.nextPageIndex,\n                state.pageIndex,\n                state.pages,\n            ]\n        );\n\n        const setIsAnimating = useCallback(\n            (val: boolean) => {\n                setState({\n                    isAnimating: val,\n                });\n                isAnimatingRef.current = val;\n            },\n            [setState]\n        );\n\n        const getPageStyle = (right: boolean, front: boolean) => {\n            if (!singleImageMode && isPortrait) {\n                const pageStyle: any = {\n                    height: containerSize.height,\n                    width: containerSize.width * 2,\n                    position: 'absolute',\n                };\n\n                const isEvenPage = pageIndex % 2 === 0;\n\n                if (front) {\n                    if (isEvenPage) {\n                        pageStyle.left = right ? 0 : -containerSize.width;\n                    } else {\n                        pageStyle.left = right ? -containerSize.width : 0;\n                    }\n                } else {\n                    if (isEvenPage) {\n                        pageStyle.left = right ? -containerSize.width : 0;\n                    } else {\n                        pageStyle.left = right ? 0 : -containerSize.width;\n                    }\n                }\n                return pageStyle;\n            }\n\n            const pageStyle: any = {\n                height: containerSize.height,\n                width:\n                    singleImageMode && !isPortrait\n                        ? containerSize.width / 2\n                        : containerSize.width,\n                position: 'absolute',\n            };\n\n            const offset = singleImageMode ? 0 : -containerSize.width / 2;\n\n            if (isPortrait && front) {\n                pageStyle.left = 0;\n            } else if ((front && right) || (!front && right)) {\n                // front right or back right\n                pageStyle.left = offset;\n            } else if (front && !right) {\n                // front left\n                pageStyle.right = offset;\n            }\n\n            return pageStyle;\n        };\n\n        if (!state.initialized) {\n            return null;\n        }\n\n        const {\n            current,\n            pageIndex,\n            pages,\n            next,\n            prev,\n            isPortrait,\n            isAnimating,\n        } = state;\n        const isFirstPage = pageIndex === 0;\n        const isLastPage = pageIndex === pages.length - 1;\n        const isSecondToLastPage = pageIndex === pages.length - 2;\n        const shouldRenderLastPage =\n            (isSecondToLastPage || isLastPage) &&\n            singleImageMode &&\n            data.length % 2 !== 0;\n\n        const bookPageProps: Omit<IBookPageProps, 'right' | 'front' | 'back'> =\n            {\n                containerSize: containerSize,\n                isAnimating: isAnimating,\n                enabled,\n                setIsAnimating: setIsAnimating,\n                isAnimatingRef: isAnimatingRef,\n                onPageFlip: onPageFlipped,\n                getPageStyle,\n                single: singleImageMode,\n                onFlipStart,\n                onPageDrag,\n                onPageDragEnd,\n                onPageDragStart,\n                isPressable: pressable,\n                renderPage,\n            };\n\n        const ContentWrapper = renderContainer ? renderContainer : Wrapper;\n\n        return (\n            <View style={styles.container} onLayout={onLayout}>\n                <View\n                    style={[\n                        styles.contentContainer,\n                        {\n                            height: containerSize.height,\n                            width: containerSize.width,\n                        },\n                        contentContainerStyle,\n                    ]}\n                >\n                    <ContentWrapper>\n                        {!isPortrait ? (\n                            <View style={styles.content}>\n                                {!prev ? (\n                                    <Empty />\n                                ) : (\n                                    <BookPage\n                                        ref={prevBookPage}\n                                        right={false}\n                                        front={current}\n                                        back={prev}\n                                        key={`left${pageIndex}`}\n                                        {...bookPageProps}\n                                    />\n                                )}\n                                {!next ? (\n                                    <Empty />\n                                ) : (\n                                    <BookPage\n                                        ref={nextBookPage}\n                                        right\n                                        front={current}\n                                        back={next}\n                                        key={`right${pageIndex}`}\n                                        {...bookPageProps}\n                                    />\n                                )}\n                                <BookPageBackground\n                                    left={!prev ? current.left : prev.left}\n                                    right={!next ? current.right : next.right}\n                                    isFirstPage={isFirstPage}\n                                    isLastPage={isLastPage}\n                                    getPageStyle={getPageStyle}\n                                    containerSize={containerSize}\n                                    renderPage={renderPage}\n                                    renderLastPage={renderLastPage}\n                                    shouldRenderLastPage={shouldRenderLastPage}\n                                />\n                            </View>\n                        ) : (\n                            <View style={styles.portraitContent}>\n                                <View\n                                    style={{ ...StyleSheet.absoluteFillObject }}\n                                >\n                                    <BookPagePortrait\n                                        {...bookPageProps}\n                                        current={current}\n                                        prev={prev}\n                                        next={next}\n                                        onPageFlip={onPageFlipped}\n                                        key={`right${pageIndex}`}\n                                        ref={portraitBookPage}\n                                    />\n                                </View>\n                                {next && (\n                                    <View\n                                        style={{\n                                            ...StyleSheet.absoluteFillObject,\n                                            zIndex: -5,\n                                            overflow: 'hidden',\n                                        }}\n                                    >\n                                        {renderPage && (\n                                            <View\n                                                style={getPageStyle(\n                                                    true,\n                                                    false\n                                                )}\n                                            >\n                                                {renderPage(next.right)}\n                                            </View>\n                                        )}\n                                    </View>\n                                )}\n                            </View>\n                        )}\n                    </ContentWrapper>\n                </View>\n            </View>\n        );\n    }\n);\n\nexport default React.memo(PageFlipper);\n\nconst Wrapper = (props: any) => <View style={styles.wrap} {...props} />;\n\nconst Empty = () => <View style={styles.container} pointerEvents=\"none\" />;\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        justifyContent: 'center',\n        alignItems: 'center',\n    },\n    wrap: {\n        flex: 1,\n    },\n    contentContainer: {\n        flexDirection: 'row',\n        // shadowColor: '#000',\n        // shadowOffset: {\n        //     width: 0,\n        //     height: 2,\n        // },\n        // shadowOpacity: 0.25,\n        // shadowRadius: 3.84,\n        // elevation: 5,\n        backgroundColor: 'white',\n    },\n    content: {\n        flex: 1,\n        flexDirection: 'row',\n        overflow: 'hidden',\n    },\n    portraitContent: {\n        flex: 1,\n        overflow: 'hidden',\n    },\n});\n"],"mappings":"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"}