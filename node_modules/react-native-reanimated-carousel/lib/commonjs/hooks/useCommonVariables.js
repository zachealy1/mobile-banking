"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.useCommonVariables = useCommonVariables;

var _reactNativeReanimated = require("react-native-reanimated");

var _computeOffsetIfDataChanged = require("../utils/compute-offset-if-data-changed");

var _computeOffsetIfSizeChanged = require("../utils/compute-offset-if-size-changed");

var _handleroffsetDirection = require("../utils/handleroffset-direction");

function useCommonVariables(props) {
  const {
    vertical,
    height,
    width,
    dataLength,
    defaultIndex,
    defaultScrollOffsetValue,
    loop
  } = props;
  const size = vertical ? height : width;
  const defaultHandlerOffsetValue = -Math.abs(defaultIndex * size);

  const _handlerOffset = (0, _reactNativeReanimated.useSharedValue)(defaultHandlerOffsetValue);

  const handlerOffset = defaultScrollOffsetValue !== null && defaultScrollOffsetValue !== void 0 ? defaultScrollOffsetValue : _handlerOffset;
  const prevDataLength = (0, _reactNativeReanimated.useSharedValue)(dataLength);
  const prevSize = (0, _reactNativeReanimated.useSharedValue)(size);
  /**
   * When data changes, we need to compute new index for handlerOffset
   */

  (0, _reactNativeReanimated.useAnimatedReaction)(() => {
    const previousLength = prevDataLength.value;
    const currentLength = dataLength;
    const isLengthChanged = previousLength !== currentLength;
    const shouldComputed = isLengthChanged && loop;
    if (shouldComputed) prevDataLength.value = dataLength;
    return {
      shouldComputed,
      previousLength,
      currentLength
    };
  }, _ref => {
    let {
      shouldComputed,
      previousLength,
      currentLength
    } = _ref;

    if (shouldComputed) {
      // direction -> 1 | -1
      const direction = (0, _handleroffsetDirection.handlerOffsetDirection)(handlerOffset);
      handlerOffset.value = (0, _computeOffsetIfDataChanged.computeOffsetIfDataChanged)({
        direction,
        previousLength,
        currentLength,
        size,
        handlerOffset: handlerOffset.value
      });
    }
  }, [dataLength, loop]);
  /**
   * When size changes, we need to compute new index for handlerOffset
   */

  (0, _reactNativeReanimated.useAnimatedReaction)(() => {
    const previousSize = prevSize.value;
    const isSizeChanged = previousSize !== size;
    const shouldComputed = isSizeChanged;
    if (shouldComputed) prevSize.value = size;
    return {
      shouldComputed,
      previousSize,
      size
    };
  }, _ref2 => {
    let {
      shouldComputed,
      previousSize,
      size
    } = _ref2;

    if (shouldComputed) {
      handlerOffset.value = (0, _computeOffsetIfSizeChanged.computeOffsetIfSizeChanged)({
        handlerOffset: handlerOffset.value,
        prevSize: previousSize,
        size
      });
    }
  }, [size]);
  return {
    size,
    validLength: dataLength - 1,
    handlerOffset
  };
}
//# sourceMappingURL=useCommonVariables.js.map